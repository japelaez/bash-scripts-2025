âœ… verify_new_password.sh

This script checks whether the new password works.

#!/bin/bash

USER="yourusername"
NEW_PASS="NewPassword456"
SERVER_LIST="servers.txt"
FAILED_LIST="failed_servers.txt"

# Clear previous failed list (optional)
> "$FAILED_LIST"

# Timeout settings
SSH_CONNECT_TIMEOUT=5
COMMAND_TIMEOUT=8

for SERVER in $(cat "$SERVER_LIST"); do
    echo "Checking $SERVER ..."

    # Try SSH login with new password
    timeout $COMMAND_TIMEOUT sshpass -p "$NEW_PASS" \
        ssh -o StrictHostKeyChecking=no \
            -o ConnectTimeout=$SSH_CONNECT_TIMEOUT \
            -o PreferredAuthentications=password \
            -o LogLevel=ERROR \
            "$USER@$SERVER" "echo login_success" \
            >/dev/null 2>&1

    EXIT_CODE=$?

    if [ $EXIT_CODE -eq 0 ]; then
        echo "SUCCESS: New password works on $SERVER"
    else
        echo "FAILED: New password does NOT work on $SERVER"
        echo "$SERVER" >> "$FAILED_LIST"
    fi

    echo "----------------------------------------"
done

echo
echo "Done. Any failed servers saved in: $FAILED_LIST"
